@model IEnumerable<_3DPrintsAPP.ViewModels.PrintViewModel>

@{
    ViewData["Title"] = "Home";
}

<link rel="stylesheet" href="~/css/home.css" asp-append-version="true" />

<section class="bl-hero">
    <div class="container">
        <div class="row align-items-center g-4">

            <!-- LEFT -->
            <div class="col-lg-7">
                <div class="bl-badge mb-3">
                    <span class="dot"></span>
                    3D Prints • Inspirations • Utility
                </div>

                <h1 class="bl-title">Utility prints, setups, and material ideas.</h1>

                <p class="bl-subtitle">
                    Keep everything in one place — printers, filaments, and prints with photos, time, date and notes.
                </p>

                <div class="d-flex flex-wrap gap-2 mt-4">

                    @if (User?.Identity?.IsAuthenticated == true)
                    {
                        <a class="btn btn-light px-4"
                           asp-controller="Prints"
                           asp-action="Index">Explore Prints</a>

                        <a class="btn btn-outline-light px-4"
                           asp-controller="Printers"
                           asp-action="Index">Printers</a>

                        <a class="btn btn-outline-light px-4"
                           asp-controller="Filaments"
                           asp-action="Index">Filaments</a>
                    }
                    else
                    {
                        <a class="btn btn-light px-4"
                           asp-area="Identity"
                           asp-page="/Account/Register">Get started</a>

                        <a class="btn btn-outline-light px-4"
                           asp-area="Identity"
                           asp-page="/Account/Login">Sign in</a>
                    }
                </div>
            </div>

            <!-- RIGHT -->
            <div class="col-lg-5">
                <div class="bl-hero-card">
                    <div class="bl-hero-card__img">
                        <img src="~/images/Bambu.jpg" alt="3D prints" />
                    </div>
                    <div class="bl-hero-card__body">
                        <div class="bl-hero-card__title">Featured utility</div>
                        <div class="bl-hero-card__desc">
                             Best printer for 2026
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>


<!-- TOOLBAR -->
<div class="container">
    <div class="bl-toolbar">

        <div class="bl-tabs">
            <button type="button" class="bl-tab active" data-filter="all">All</button>
        </div>

        <div class="bl-search">
            <span class="bl-search__icon">⌕</span>
            <input id="searchBox" class="form-control" placeholder="Search inspirations..." />
        </div>

    </div>


    <!-- GRID -->
    <div id="grid" class="bl-grid">

        @if (User?.Identity?.IsAuthenticated == true && Model != null && Model.Any())
        {
            @foreach (var p in Model)
            {
                <a class="bl-card"
                   asp-controller="Prints"
                   asp-action="Details"
                   asp-route-id="@p.Id"
                   data-tags="utility print">

                    <div class="bl-card__thumb">
                        <img src="@p.UploadPhoto" alt="@p.Title" />
                    </div>

                    <div class="bl-card__body">

                        <div class="bl-card__meta">
                            <span class="pill">Print</span>
                            <span class="pill ghost">@p.PrinterModelName</span>
                        </div>

                        <div class="bl-card__title">@p.Title</div>

                        <div class="bl-card__desc">
                            @p.Description
                        </div>

                        <div class="bl-card__meta mt-2">
                            <span class="pill ghost">@p.PrintTime</span>
                            <span class="pill ghost">@p.UploadedTime.ToShortDateString()</span>
                        </div>

                    </div>
                </a>
            }
        }
        else
        {
            <!-- Guest fallback -->
            <a class="bl-card"
               asp-area="Identity"
               asp-page="/Account/Login"
               data-tags="welcome">

                <div class="bl-card__thumb">
                    <img src="~/images/card1.jpg" alt="Login" />
                </div>

                <div class="bl-card__body">

                    <div class="bl-card__meta">
                        <span class="pill">Welcome</span>
                    </div>

                    <div class="bl-card__title">Sign in to see your prints</div>

                    <div class="bl-card__desc">
                        Create an account to manage printers, filaments and prints.
                    </div>

                </div>
            </a>
        }

    </div>
</div>


@section Scripts {
    <script>
        (function () {

            const tabs = document.querySelectorAll('.bl-tab');
            const cards = Array.from(document.querySelectorAll('#grid .bl-card'));
            const searchBox = document.getElementById('searchBox');

            let active = "all";

            function apply() {
                const q = (searchBox.value || "").trim().toLowerCase();

                cards.forEach(c => {
                    const tags = (c.getAttribute('data-tags') || "").toLowerCase();
                    const tabOk = active === "all" || tags.includes(active);
                    const searchOk = !q || tags.includes(q) || c.innerText.toLowerCase().includes(q);

                    c.style.display = (tabOk && searchOk) ? "" : "none";
                });
            }

            tabs.forEach(t => {
                t.addEventListener('click', () => {
                    tabs.forEach(x => x.classList.remove('active'));
                    t.classList.add('active');
                    active = t.getAttribute('data-filter');
                    apply();
                });
            });

            searchBox.addEventListener('input', apply);

        })();
    </script>
}
